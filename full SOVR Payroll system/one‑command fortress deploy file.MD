ğŸ’€âš¡ Roger that, Captain. Iâ€™ll forge you a oneâ€‘command fortress deploy file â€” a docker-compose.yml upgrade that spawns both Consul (backend brain) + Operator Dashboard (frontend war room) together, wired into your .env secrets.

This is your deployment siege ram: docker-compose up -d â†’ empire online.

ğŸ¯ GEMINI CLI DIRECTIVE: Phase 5.6 â€” Oneâ€‘Command Fortress Deployment

Mission: Deploy Consul and Operator Dashboard together as a unified stack using Docker Compose.
Objective: Operators and backend run under one deploy â€” continuous listening, event broadcasts, and realâ€‘time UI.

ğŸ”¹ Step 1 â€” Forge docker-compose.yml

In your project root (FULL SOVR PAYROLL SYSTEM), create/replace a docker-compose.yml:

version: '3.9'

services:
  consul:
    build: ./consul
    container_name: consul-service
    restart: always
    env_file: .env
    ports:
      - "4000:4000"   # Consul listens/broadcasts events
    depends_on:
      - db

  dashboard:
    build: ./dashboard-ui
    container_name: dashboard-service
    restart: always
    environment:
      - NEXT_PUBLIC_WS_URL=ws://consul:4000
    ports:
      - "3000:3000"   # Operator dashboard UI
    depends_on:
      - consul

  db:
    image: postgres:15
    container_name: sovr-db
    restart: always
    environment:
      POSTGRES_USER=postgres
      POSTGRES_PASSWORD=fortress
      POSTGRES_DB=sovrpayroll
    ports:
      - "5432:5432"
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:

ğŸ”¹ Step 2 â€” Ensure Dockerfile Exists in Each Service

consul/Dockerfile

FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
CMD ["node", "consul.js"]


dashboard-ui/Dockerfile

FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]

ğŸ”¹ Step 3 â€” Fire the Deployment
docker-compose up -d --build


Expected:

âœ” consul-service started on :4000
âœ” dashboard-service started on :3000
âœ” sovr-db running on :5432

ğŸ”¹ Step 4 â€” Verify the Fortress

Check Consul logs:

docker logs -f consul-service


Should show: âš”ï¸ Listening for SalaryClaimed.

Open Dashboard:
Go to http://localhost:3000 (or mapped domain).
You should see Live Feed, Ledger, Reconciliation Alerts, Proof Explorer.

Trigger claim to fire test:

node scripts/triggerClaim.js --employee 0xEMPLOYEE --amount 1


Dashboard feed lights: âš¡ â†’ ğŸ’³ â†’ ğŸ”¥

ğŸ† Success War State

âœ… Oneâ€‘command deploy brings up Consul, Dashboard, and DB.
âœ… Operators access dashboard via http://serverip:3000.
âœ… Consul emits on ws://serverip:4000.
âœ… DB persists history for Phase 7 analytics.
âœ… Push â†’ Pay â†’ Burn â†’ Proof â†’ Visual all live.

END DIRECTIVE

ğŸ’€âš¡ Goggle/Gemini CLI: execute directive. Build docker-compose.yml, Dockerfiles, run docker-compose up -d.

Captain â€” do you want me to add DNS + TLS instructions next (e.g., https://dashboard.sovrpayroll.io) so your war room is polished and safe for external operators, or keep it raw with just server IP for now?